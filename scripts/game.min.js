"use strict";var _createClass=function(){function a(c,d){for(var g,f=0;f<d.length;f++)g=d[f],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(c,g.key,g)}return function(c,d,f){return d&&a(c.prototype,d),f&&a(c,f),c}}();function _possibleConstructorReturn(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c&&("object"==typeof c||"function"==typeof c)?c:a}function _inherits(a,c){if("function"!=typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function _classCallCheck(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}var LevelData=function a(){_classCallCheck(this,a),this.levels=[{gapX:0,gapY:30,widthDiff:0,total:5,coinChance:0.4,ememyChance:0.2},{gapX:0,gapY:30,widthDiff:10,total:20,coinChance:0.5,ememyChance:0.3},{gapX:10,gapY:35,widthDiff:15,total:50,coinChance:0.5,ememyChance:0.3},{gapX:20,gapY:40,widthDiff:20,total:100,coinChance:0.6,ememyChance:0.4},{gapX:30,gapY:40,widthDiff:25,total:120,coinChance:0.6,ememyChance:0.4}]},SoundPlayer=function(){function a(){_classCallCheck(this,a),this.soundOn=!1}return _createClass(a,[{key:"playSound",value:function playSound(c){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(this.soundOn){var d=createjs.Sound.play(c,{loop:f});return d}return!1}}]),a}(),SceneManager=function(){function a(){_classCallCheck(this,a),this.menuScene=document.querySelector("#menu"),this.gameScene=document.querySelector("#gameCanvas"),this.startButton=document.querySelector("#start-game-button"),this.gameOverScene=document.querySelector("#gameover"),this.restartButton=document.querySelector("#restart-game-button"),this.exitButton=document.querySelector("#exit-button"),this.hud=document.querySelector("#hud"),this.scoreText=document.querySelector("#score-text"),this.highscoreText=document.querySelector("#highscore-text"),this.handlePlayerClick(),this.setHighScore()}return _createClass(a,[{key:"showGame",value:function showGame(){this.gameOverScene.classList.remove("active"),this.menuScene.classList.remove("active"),this.showHud(),this.setGameScore(0)}},{key:"showHud",value:function showHud(){this.hud.classList.add("active")}},{key:"hideHud",value:function hideHud(){this.hud.classList.remove("active")}},{key:"setGameScore",value:function setGameScore(c){this.scoreText.textContent=c}},{key:"setHighScore",value:function setHighScore(){this.highscoreText.textContent=void 0===localStorage.rushHighScore?0:localStorage.rushHighScore}},{key:"gameOver",value:function gameOver(){this.hideHud(),this.gameOverScene.classList.add("active"),this.setHighScore()}},{key:"showMenu",value:function showMenu(){this.menuScene.classList.add("active"),this.gameOverScene.classList.remove("active")}},{key:"handlePlayerClick",value:function handlePlayerClick(){var c=this;this.startButton.addEventListener("click",function(d){return d.preventDefault(),c.showGame(),game.loadGraphics(),!1}),this.restartButton.addEventListener("click",function(d){return d.preventDefault(),c.showGame(),game.loadGraphics(),!1}),this.exitButton.addEventListener("click",function(d){return d.preventDefault(),c.showMenu(),!1})}}]),a}(),ScoreCalculator=function(){function a(){_classCallCheck(this,a),this.score=0}return _createClass(a,[{key:"increaseScore",value:function increaseScore(c){this.score+=(c+1)*(c+1)}}]),a}(),GameObject=function(a){function c(d){_classCallCheck(this,c);var f=_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));if(void 0!==d){f.graphic=d,f.addChild(d);var g=f.graphic.nominalBounds;f.setBounds(g.x,g.y,g.width,g.height)}return f}return _inherits(c,a),c}(createjs.Container),MovableGameObject=function(a){function c(d){_classCallCheck(this,c);var f=_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,d));return f.velocity={x:0,y:0},f.isOnGround=!1,f.on("tick",f.tick),f}return _inherits(c,a),_createClass(c,[{key:"tick",value:function tick(){this.y+=this.velocity.y,this.x+=this.velocity.x}}]),c}(GameObject),Hero=function(a){function c(){return _classCallCheck(this,c),_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,new library.HeroGraphic))}return _inherits(c,a),_createClass(c,[{key:"run",value:function run(){this.isOnGround||(this.velocity.x=2,this.graphic.gotoAndPlay("run"),this.isOnGround=!0)}},{key:"jump",value:function jump(){this.isOnGround&&(this.velocity.y=-13,soundPlayer.playSound("jump"),this.graphic.gotoAndPlay("jump"),this.isOnGround=!1)}}]),c}(MovableGameObject),Coin=function(a){function c(){return _classCallCheck(this,c),_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,new library.CoinGraphic))}return _inherits(c,a),c}(GameObject),Enemy=function(a){function c(){_classCallCheck(this,c);var d=_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,new library.ObstacleGraphic));return d.directionX=-1,d.speed=0.5,d.offsetX=0,d.maxOffset=10,d.on("tick",d.move),d}return _inherits(c,a),_createClass(c,[{key:"move",value:function move(){this.velocity.x=this.speed*this.directionX,this.offsetX+=this.velocity.x,Math.abs(this.offsetX)>this.maxOffset&&(this.directionX*=-1)}}]),c}(MovableGameObject),Platform=function(a){function c(){return _classCallCheck(this,c),_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,new library.PlatformGraphic))}return _inherits(c,a),_createClass(c,[{key:"setClippingWidth",value:function setClippingWidth(d){this.graphic.instance.mask=new createjs.Shape(new createjs.Graphics().beginFill("#000").drawRect(0,0,d,this.getBounds().height)),this.setBounds(this.x,this.y,d,this.getBounds().height)}}]),c}(GameObject),World=function(a){function c(){_classCallCheck(this,c);var d=_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return d.levelData=new LevelData,d.scoreCalculator=new ScoreCalculator,d.currentLevel=0,d.on("tick",d.tick),d.platforms=[],d.enemies=[],d.coins=[],d.generatePlatforms(),d.generateEnemies(),d.generateCoins(),d.addHero(),d}return _inherits(c,a),_createClass(c,[{key:"tick",value:function tick(){this.applyGravity();var d=this.targetHitTestObjects(this.hero,this.enemies);!1!==d&&(soundPlayer.playSound("fire"),game.gameOver()),this.hero.y>game.stage.canvas.height&&(soundPlayer.playSound("fall"),game.gameOver());var f=this.targetHitTestObjects(this.hero,this.coins);!1!==f&&(this.eatCoin(f),soundPlayer.playSound("coin"),this.scoreCalculator.increaseScore(this.currentLevel),sceneManager.setGameScore(this.scoreCalculator.score)),this.x-=this.hero.velocity.x}},{key:"addHero",value:function addHero(){var d=new Hero;this.addChild(d),d.x=d.y=100,d.y=2,this.hero=d}},{key:"generatePlatforms",value:function generatePlatforms(){var d=100,f=200,g=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var l,m,k=this.levelData.levels[Symbol.iterator]();!(_iteratorNormalCompletion=(l=k.next()).done);_iteratorNormalCompletion=!0){m=l.value;for(var h,n=0;n<m.total;n++){h=new Platform,h.x=d,h.y=f;var j=h.getBounds().width;h.setClippingWidth(j-Math.random()*m.widthDiff),h.levelNumber=g,this.platforms.push(h),this.addChild(h),d=h.x+h.getBounds().width+Math.random()*m.gapX,f=h.y+(Math.random()-0.5)*m.gapY}g++}}catch(o){_didIteratorError=!0,_iteratorError=o}finally{try{!_iteratorNormalCompletion&&k.return&&k.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"generateEnemies",value:function generateEnemies(){for(var j=2;j<this.platforms.length;j++){var d=this.platforms[j],f=d.levelNumber,g=this.levelData.levels[f].ememyChance;if(Math.random()<g){var h=new Enemy;h.x=d.x+d.getBounds().width/2,h.y=d.y-h.getBounds().height,this.addChild(h),this.enemies.push(h)}}}},{key:"generateCoins",value:function generateCoins(){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var h,g=this.platforms[Symbol.iterator]();!(_iteratorNormalCompletion2=(h=g.next()).done);_iteratorNormalCompletion2=!0){var j=h.value,d=j.levelNumber,f=this.levelData.levels[d].coinChance;if(Math.random()<f){var k=new Coin;k.x=j.x+Math.random()*j.getBounds().width,k.y=j.y-k.getBounds().height,this.addChild(k),this.coins.push(k)}}}catch(l){_didIteratorError2=!0,_iteratorError2=l}finally{try{!_iteratorNormalCompletion2&&g.return&&g.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"applyGravity",value:function applyGravity(){var g=this.hero;g.velocity.y+=1,g.velocity.y=Math.min(g.velocity.y,5),this.willObjectOnGround(g)&&(g.velocity.y=1);var h=this.isObjectOnGround(g);!1!==h&&0<g.velocity.y&&(this.currentLevel=h.levelNumber,g.velocity.y=0,this.hero.run())}},{key:"isObjectOnGround",value:function isObjectOnGround(d){for(var f=d.getBounds().width,g=d.getBounds().height,h=this.platforms,l=0;l<this.platforms.length;l++){var j=this.platforms[l].getBounds().width,k=this.platforms[l].getBounds().height;if(d.x>=h[l].x&&d.x<h[l].x+j&&d.y+g>=h[l].y&&d.y+g<=h[l].y+k)return h[l]}return!1}},{key:"willObjectOnGround",value:function willObjectOnGround(d){for(var f=d.getBounds().width,g=d.getBounds().height,h=d.y+g+d.velocity.y,j=this.platforms,m=0;m<this.platforms.length;m++){var k=this.platforms[m].getBounds().width,l=this.platforms[m].getBounds().height;if(d.x>=j[m].x&&d.x<j[m].x+k&&h>=j[m].y&&h<=j[m].y+l)return!0}return!1}},{key:"objectsHitTest",value:function objectsHitTest(d,f){var g=d.x,h=d.y,j=d.getBounds().width,k=d.getBounds().height,l=f.x,m=f.y,n=f.getBounds().width,o=f.getBounds().height;return 2*Math.abs(g-l)<j+n&&2*Math.abs(h-m)<k+o}},{key:"targetHitTestObjects",value:function targetHitTestObjects(d,f){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var j,g,h=f[Symbol.iterator]();!(_iteratorNormalCompletion3=(j=h.next()).done);_iteratorNormalCompletion3=!0)if(g=j.value,this.objectsHitTest(d,g))return g}catch(k){_didIteratorError3=!0,_iteratorError3=k}finally{try{!_iteratorNormalCompletion3&&h.return&&h.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return!1}},{key:"eatCoin",value:function eatCoin(d){for(var f=0;f<this.coins.length;f++)d===this.coins[f]&&this.coins.splice(f,1);d.parent.removeChild(d)}}]),c}(createjs.Container),Game=function(){function a(){_classCallCheck(this,a),this.canvas=document.getElementById("gameCanvas"),this.stage=new createjs.Stage(this.canvas),this.gameLoaded=!1,createjs.Touch.enable(this.stage),this.loadSounds(),createjs.Ticker.framerate=70,createjs.Ticker.addEventListener("tick",this.stage)}return _createClass(a,[{key:"startGame",value:function startGame(){this.isGameOver=!1,soundPlayer.soundOn=!0,this.stage.removeAllChildren(),this.themeMusic=soundPlayer.playSound("theme",-1),this.stage.addChild(new library.BackgroundGraphic),this.world=new World,this.stage.addChild(this.world);var c=this.world.hero;this.stage.on("stagemousedown",function(){c.jump()}),window.addEventListener("keydown",function(d){32===d.keyCode&&c.jump()})}},{key:"gameOver",value:function gameOver(){void 0===localStorage.rushHighScore?localStorage.rushHighScore=this.world.scoreCalculator.score:localStorage.rushHighScore<this.world.scoreCalculator.score&&(localStorage.rushHighScore=this.world.scoreCalculator.score),soundPlayer.playSound("gameover"),soundPlayer.soundOn=!1,this.themeMusic.stop(),this.isGameOver||(sceneManager.gameOver(),this.isGameOver=!0)}},{key:"loadSounds",value:function loadSounds(){createjs.Sound.alternateExtensions=["aac"],createjs.Sound.registerSounds([{src:"theme.ogg",id:"theme",data:1},{src:"coin.ogg",id:"coin"},{src:"fall.ogg",id:"fall"},{src:"fire.ogg",id:"fire"},{src:"gameover.ogg",id:"gameover"},{src:"jump.ogg",id:"jump"}],"sound/")}},{key:"loadGraphics",value:function loadGraphics(){var f=AdobeAn.getComposition("BEA1C68EC7BC6140BE9E0F69E1D47BF0"),g=f.getLibrary(),h=new createjs.LoadQueue(!1);h.addEventListener("fileload",function(j){var k=f.getImages();j&&"image"==j.item.type&&(k[j.item.id]=j.result)}),h.addEventListener("complete",function(j){for(var k=f.getLibrary(),l=f.getSpriteSheet(),m=j.target,n=k.ssMetadata,o=0;o<n.length;o++)l[n[o].name]=new createjs.SpriteSheet({images:[m.getResult(n[o].name)],frames:n[o].frames});this.startGame(),this.canvas.classList.add("gameLoaded")}.bind(this));var g=f.getLibrary();h.loadManifest(g.properties.manifest)}}]),a}(),soundPlayer=new SoundPlayer,game=new Game,sceneManager=new SceneManager;